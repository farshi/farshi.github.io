
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>FARSHI DESIGNS</title>
  <meta name="author" content="Reza Farshi">

  
  <meta name="description" content="In This Blog post I’m trying to setup an ECS container in a custom cluster with one docker instance inside by using AWS CLI. The AWS user guides &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.farshidesigns.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="FARSHI DESIGNS" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-61874438-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">FARSHI DESIGNS</a></h1>
  
    <h2>My thoughts on Software Architecture, Cloud Implementation , DevOps, Agile, Technology, Life and my favorite sport Paragliding.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="www.farshidesigns.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/14/setup-a-aws-ecs-container-purely-using-cli/">Setup a AWS ECS Container Purely Using CLI</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-14T23:03:10+10:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:03 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In This Blog post I’m trying to setup an ECS container in a custom cluster with one docker instance inside by using AWS CLI. The  <a href="http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_AWSCLI.html">AWS user guides</a> partially describes how to setup an EC2 Container service using the AWS CLI but in some steps It leaves some tricks to the reader, for example user have to login to AWS console to setup EC2 machine needed to act as an ECS machine or in one of the steps you have to login and create needed an IAM role and required policies to assign to the EC2 machine. We need to assign appropriate role to the Ec2 Machine to letting it to communicate with ECS service to register and deregister the Ec2 Machine as a resource.</p>

<p>In this post I walk through you to setup everything purely by AWS CLI commands from start to finish. It includes:</p>

<ul>
<li>Configuring AWS CLI environment on the user machine.</li>
<li>Creating key pair which is need to connect to the EC2 machine.</li>
<li>Creating the instance of EC2 machine.</li>
<li>Creating the required IAM role and in-line attached policies to assign to the EC2.</li>
<li>Configuring EC2 machine to be assigned to custom cluster instead of default one.</li>
</ul>


<p>This guide includes other steps which already have been described by AWS user guide itself and I did not add new stuffs to those steps but I reproduce that commands too. These steps are  Including task definition and ruining the task.</p>

<p>Let’s get started with configuring the AWS CLI environment on your machine.</p>

<h2>Step 1 - configure keys</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">configure</span>
</span><span class='line'><span class="n">AWS</span> <span class="n">Access</span> <span class="n">Key</span> <span class="n">ID</span> <span class="p">[]</span><span class="o">:****************</span><span class="mi">6</span><span class="n">HEQ</span>
</span><span class='line'><span class="n">AWS</span> <span class="n">Secret</span> <span class="n">Access</span> <span class="n">Key</span> <span class="p">[]</span><span class="o">:****************</span><span class="n">mFbV</span>
</span><span class='line'><span class="n">Default</span> <span class="n">region</span> <span class="n">name</span> <span class="p">[]</span><span class="o">:</span> <span class="n">ap</span><span class="o">-</span><span class="n">southeast</span><span class="o">-</span><span class="mi">2</span>
</span><span class='line'><span class="n">Default</span> <span class="n">output</span> <span class="n">format</span> <span class="p">[]</span><span class="o">:</span><span class="n">Json</span>
</span></code></pre></td></tr></table></div></figure>


<p>I choose ap-southeast-2 , coz I am using Sydney region.</p>

<h2>Step 2: Create a Cluster</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ecs</span> <span class="n">create</span><span class="o">-</span><span class="n">cluster</span> <span class="o">--</span><span class="n">cluster</span><span class="o">-</span><span class="n">name</span> <span class="n">MyCluster</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;cluster&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;status&quot;</span><span class="o">:</span> <span class="s">&quot;ACTIVE&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;clusterName&quot;</span><span class="o">:</span> <span class="s">&quot;MyCluster&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;registeredContainerInstancesCount&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;pendingTasksCount&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;runningTasksCount&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;clusterArn&quot;</span><span class="o">:</span> <span class="s">&quot;arn:aws:ecs:ap-southeast-2:338764315603:cluster/MyCluster&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This Step is optional, If you don&rsquo;t create a cluster containers will be created on the default cluster.</p>

<h2>Step 3: Launch an Instance with the Amazon ECS AMI</h2>

<p>This step includes some sub steps.</p>

<h3>Step 3-1 : Creating a Key Pair</h3>

<p>To create a key pair named MyKeyPair, use the create-key-pair command, and use the <code>--query</code> option and the <code>--output</code> text option to pipe your private key directly into a file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="n">create</span><span class="o">-</span><span class="n">key</span><span class="o">-</span><span class="n">pair</span> <span class="o">--</span><span class="n">key</span><span class="o">-</span><span class="n">name</span> <span class="n">MyKeyPair</span> <span class="o">--</span><span class="n">query</span> <span class="err">&#39;</span><span class="n">KeyMaterial</span><span class="err">&#39;</span> <span class="o">--</span><span class="n">output</span> <span class="n">text</span> <span class="o">&gt;</span> <span class="n">MyKeyPair</span><span class="p">.</span><span class="n">pem</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you&rsquo;re using an SSH client on a Linux computer to connect to your instance, use the following command to set the permissions of your private key file so that only you can read it.</p>

<p><code> ~/ chmod 400 MyKeyPair.pem</code></p>

<p>To displaying Your Key Pair to verify you have done the key pair creation.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="n">describe</span><span class="o">-</span><span class="n">key</span><span class="o">-</span><span class="n">pairs</span> <span class="o">--</span><span class="n">key</span><span class="o">-</span><span class="n">name</span> <span class="n">MyKeyPair</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;KeyPairs&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="s">&quot;KeyName&quot;</span><span class="o">:</span> <span class="s">&quot;MyKeyPair&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&quot;KeyFingerprint&quot;</span><span class="o">:</span> <span class="s">&quot;df:6a:55:cc:66:4f:2e:a3:8b:ca:67:16:be:b9:f5:4a:db:5a:26:1a&quot;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 3-2 : Creating a Security Group</h3>

<p>Containers associated with your tasks can map their network ports to ports on the host Amazon ECS container instance so they are reachable from the Internet. If your container has external connectivity, then your container instance security group must allow inbound access to the ports you want to expose.</p>

<p>Here we don’t want to have a docker instance to communicate with outside but I open the port 22 coz later we might want to login into the machine and inspect AWS ecs-agent and our created docker instance. AWS ecs-agent is a docket instance by itself. In the real production environment it’s not a good practice to open ssh port on the ECS machine but if you wan to do it you should choose restricted CIDR instead of 0.0.0.0/0.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="n">create</span><span class="o">-</span><span class="n">security</span><span class="o">-</span><span class="n">group</span> <span class="o">--</span><span class="n">group</span><span class="o">-</span><span class="n">name</span> <span class="n">MySecurityGroup</span> <span class="o">--</span><span class="n">description</span> <span class="s">&quot;My security group”</span>
</span><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="n">authorize</span><span class="o">-</span><span class="n">security</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">ingress</span> <span class="o">--</span><span class="n">group</span><span class="o">-</span><span class="n">name</span> <span class="n">MySecurityGroup</span> <span class="o">--</span><span class="n">protocol</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">port</span> <span class="mi">22</span> <span class="o">--</span><span class="n">cidr</span> <span class="mf">0.0.0.0</span><span class="o">/</span><span class="mi">0</span>
</span><span class='line'><span class="err"></span> <span class="o">~/</span>  <span class="n">aws</span> <span class="n">ec2</span> <span class="n">describe</span><span class="o">-</span><span class="n">security</span><span class="o">-</span><span class="n">groups</span> <span class="o">--</span><span class="n">group</span><span class="o">-</span><span class="n">names</span> <span class="n">MySecurityGroup</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 3-3: Creating userdata.txt to specify ClusterName</h3>

<p>By default, your container instance launches into your default cluster. If you want to launch into your own cluster instead of the default, replacing &lsquo;your_cluster_name&rsquo; with the name of your cluster.</p>

<p><code>#!/bin/bash
echo ECS_CLUSTER=your_cluster_name &gt;&gt; /etc/ecs/ecs.config</code></p>

<p>Create a file <code>userdata.txt</code> and paste these lines into it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#!/bin/bash </span>
</span><span class='line'><span class="n">echo</span> <span class="n">ECS_CLUSTER</span><span class="o">=</span><span class="n">MyCluster</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ecs</span><span class="o">/</span><span class="n">ecs</span><span class="p">.</span><span class="n">config</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 3-4 : Creating required instance profile, role and policy</h3>

<p>In this step we want to create the required role with inline policy and assign the role to the instance profile. Because the Amazon ECS container agent makes calls to Amazon ECS on your behalf, you need to launch container instances with an IAM role that authenticates to your account and provides the required resource permissions.</p>

<p>Create a new file <code>ecsPolicy.json</code> using nano or vim and put following lines into the file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;Version&quot;</span><span class="o">:</span> <span class="s">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s">&quot;Statement&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;Sid&quot;</span><span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;Effect&quot;</span><span class="o">:</span> <span class="s">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;Principal&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;Service&quot;</span><span class="o">:</span> <span class="s">&quot;ec2.amazonaws.com&quot;</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="s">&quot;Action&quot;</span><span class="o">:</span> <span class="s">&quot;sts:AssumeRole&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create a new file <code>rolePolicy.json</code> and put the following lines into the file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'> <span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;Version&quot;</span><span class="o">:</span> <span class="s">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s">&quot;Statement&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;Effect&quot;</span><span class="o">:</span> <span class="s">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;Action&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s">&quot;ecs:CreateCluster&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;ecs:DeregisterContainerInstance&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;ecs:DiscoverPollEndpoint&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;ecs:Poll&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;ecs:RegisterContainerInstance&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;ecs:Submit*&quot;</span>
</span><span class='line'>      <span class="p">],</span>
</span><span class='line'>      <span class="s">&quot;Resource&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s">&quot;*&quot;</span>
</span><span class='line'>      <span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then issue these set of commands:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span><span class="p">.</span><span class="n">aws</span><span class="o">/</span> <span class="n">aws</span> <span class="n">iam</span> <span class="n">create</span><span class="o">-</span><span class="n">role</span> <span class="o">--</span><span class="n">role</span><span class="o">-</span><span class="n">name</span> <span class="n">ecsRole</span> <span class="o">--</span><span class="n">assume</span><span class="o">-</span><span class="n">role</span><span class="o">-</span><span class="n">policy</span><span class="o">-</span><span class="n">document</span> <span class="nl">file</span><span class="p">:</span><span class="c1">//ecsPolicy.json</span>
</span><span class='line'>
</span><span class='line'><span class="err"></span> <span class="o">~/</span><span class="p">.</span><span class="n">aws</span><span class="o">/</span> <span class="n">aws</span> <span class="n">iam</span> <span class="n">put</span><span class="o">-</span><span class="n">role</span><span class="o">-</span><span class="n">policy</span> <span class="o">--</span><span class="n">role</span><span class="o">-</span><span class="n">name</span> <span class="n">ecsRole</span> <span class="o">--</span><span class="n">policy</span><span class="o">-</span><span class="n">name</span> <span class="n">ecsRolePolicy</span>  <span class="o">--</span><span class="n">policy</span><span class="o">-</span><span class="n">document</span> <span class="nl">file</span><span class="p">:</span><span class="c1">//rolePolicy.json</span>
</span><span class='line'>
</span><span class='line'><span class="err"></span> <span class="o">~/</span><span class="p">.</span><span class="n">aws</span><span class="o">/</span> <span class="n">aws</span> <span class="n">iam</span> <span class="n">add</span><span class="o">-</span><span class="n">role</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">instance</span><span class="o">-</span><span class="n">profile</span> <span class="o">--</span><span class="n">instance</span><span class="o">-</span><span class="n">profile</span><span class="o">-</span><span class="n">name</span> <span class="n">ecsRole</span>  <span class="o">--</span><span class="n">role</span><span class="o">-</span><span class="n">name</span> <span class="n">ecsRole</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 3-5 : Running EC2 instance on a default VPC</h3>

<p>The Amazon ECS container agent allows container instances to connect to your cluster. The Amazon ECS container agent is included in the Amazon ECS-optimized AMI, but you can also install it on any EC2 instance that supports the Amazon ECS specification. The Amazon ECS container agent is only supported on EC2 instances.</p>

<p>For finding an AMI which is ECS optimized login into the AWS console then from the console dashboard, choose Launch Instance. On the Choose an Amazon Machine Image (AMI) page, choose Community AMIs. Choose an AMI for your container instance.  you can replace image-id options by  the image-id you find.</p>

<p>I choose this AMI :
<code>amzn-ami-2015.03.b-amazon-ecs-optimized - ami-39017e03</code></p>

<p>So now we can pass security group and IAM instance profile that we created in previous steps.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="n">run</span><span class="o">-</span><span class="n">instances</span>   <span class="o">--</span><span class="n">image</span><span class="o">-</span><span class="kt">id</span> <span class="n">ami</span><span class="o">-</span><span class="mf">39017e03</span> <span class="o">--</span><span class="n">count</span> <span class="mi">1</span> <span class="o">--</span><span class="n">instance</span><span class="o">-</span><span class="n">type</span> <span class="n">t2</span><span class="p">.</span><span class="n">micro</span> <span class="o">--</span><span class="n">key</span><span class="o">-</span><span class="n">name</span> <span class="n">MyKeyPair</span> <span class="o">--</span><span class="n">iam</span><span class="o">-</span><span class="n">instance</span><span class="o">-</span><span class="n">profile</span> <span class="s">&quot;Name= ecsRole&quot;</span> <span class="o">--</span><span class="n">security</span><span class="o">-</span><span class="n">groups</span> <span class="n">MySecurityGroup</span> <span class="o">--</span><span class="n">user</span><span class="o">-</span><span class="n">data</span> <span class="nl">file</span><span class="p">:</span><span class="c1">//userdata.txt</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 3-6: Adding a Name Tag to Your Instance</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="n">create</span><span class="o">-</span><span class="n">tags</span> <span class="o">--</span><span class="n">resources</span> <span class="n">i</span><span class="o">-</span><span class="n">fcb33a20</span> <span class="o">--</span><span class="n">tags</span> <span class="n">Key</span><span class="o">=</span><span class="n">Name</span><span class="p">,</span><span class="n">Value</span><span class="o">=</span><span class="n">MyECSInstance</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Step 4:  List Container Instances</h2>

<p>by issuing this command you can see the container instances list. Because we configure ace-agent to be deployed in MyCluster, for listing
the container instance it needs cluster be specified.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ecs</span> <span class="n">list</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">instances</span> <span class="o">--</span><span class="n">cluster</span> <span class="n">MyCluster</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;containerInstanceArns&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s">&quot;arn:aws:ecs:ap-southeast-2:338764315603:container-instance/3de53ed6-5017-46fa-9b9f-37ad8a2b9da6&quot;</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Step 5: Describe your Container Instance</h2>

<p>To list the details of containers in our cluster we can use following commands. The details of containers , amount of CPU , memory capacity and also network ports will be shown.  Container-instances which listed for you by the previous command should be passed to this command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ecs</span> <span class="n">describe</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">instances</span> <span class="o">--</span><span class="n">cluster</span> <span class="n">MyCluster</span> <span class="o">--</span><span class="n">container</span><span class="o">-</span><span class="n">instances</span> <span class="mi">3</span><span class="n">de53ed6</span><span class="o">-</span><span class="mi">5017</span><span class="o">-</span><span class="mf">46f</span><span class="n">a</span><span class="o">-</span><span class="mi">9</span><span class="n">b9f</span><span class="o">-</span><span class="mi">37</span><span class="n">ad8a2b9da6</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Step 6: Register a Task Definition</h2>

<p>For defining the task we need to create a JSON file and specify the amount of memory , number of CPU units, the name of the task , the container image we want to use , and the type of the container.</p>

<p><code>~/ nano sleep360.json</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;containerDefinitions&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;sleep&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;image&quot;</span><span class="o">:</span> <span class="s">&quot;busybox&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;cpu&quot;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;command&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s">&quot;sleep&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;360&quot;</span>
</span><span class='line'>      <span class="p">],</span>
</span><span class='line'>      <span class="s">&quot;memory&quot;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;essential&quot;</span><span class="o">:</span> <span class="nb">true</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">],</span>
</span><span class='line'>  <span class="s">&quot;family&quot;</span><span class="o">:</span> <span class="s">&quot;sleep360&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here our defined task is essential and it means the cluster will be died if this container dies. our task is a simple task which wants to run a bash command  &lsquo;sleep 360&rsquo;  and the container will be terminated after running the command. exactly after 6 minutes. :D</p>

<p>by issuing the following command and passing the created file to the command we be able to register our task definition.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ecs</span> <span class="k">register</span><span class="o">-</span><span class="n">task</span><span class="o">-</span><span class="n">definition</span> <span class="o">--</span><span class="n">cli</span><span class="o">-</span><span class="n">input</span><span class="o">-</span><span class="n">json</span> <span class="nl">file</span><span class="p">:</span><span class="c1">//sleep360.json</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;taskDefinition&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;volumes&quot;</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>        <span class="s">&quot;taskDefinitionArn&quot;</span><span class="o">:</span> <span class="s">&quot;arn:aws:ecs:ap-southeast-2:338764315603:task-definition/sleep360:1&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;containerDefinitions&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="s">&quot;environment&quot;</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>                <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;sleep&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s">&quot;mountPoints&quot;</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>                <span class="s">&quot;image&quot;</span><span class="o">:</span> <span class="s">&quot;busybox&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s">&quot;cpu&quot;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span class='line'>                <span class="s">&quot;portMappings&quot;</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>                <span class="s">&quot;command&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                    <span class="s">&quot;sleep&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="s">&quot;360&quot;</span>
</span><span class='line'>                <span class="p">],</span>
</span><span class='line'>                <span class="s">&quot;memory&quot;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span class='line'>                <span class="s">&quot;essential&quot;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
</span><span class='line'>                <span class="s">&quot;volumesFrom&quot;</span><span class="o">:</span> <span class="p">[]</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">],</span>
</span><span class='line'>        <span class="s">&quot;family&quot;</span><span class="o">:</span> <span class="s">&quot;sleep360&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;revision&quot;</span><span class="o">:</span> <span class="mi">1</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>To be sure that our task is registered, issuing this command will list the defined tasks.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span>  <span class="n">aws</span> <span class="n">ecs</span> <span class="n">list</span><span class="o">-</span><span class="n">task</span><span class="o">-</span><span class="n">definitions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;taskDefinitionArns&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s">&quot;arn:aws:ecs:ap-southeast-2:338764315603:task-definition/sleep360:1&quot;</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Step 7: Run a Task</h2>

<p>To running a task simple use this command. By passing the count argument we can specify how many instance of container spin up on the cluster.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ecs</span> <span class="n">run</span><span class="o">-</span><span class="n">task</span> <span class="o">--</span><span class="n">cluster</span> <span class="n">MyCluster</span> <span class="o">--</span><span class="n">task</span><span class="o">-</span><span class="n">definition</span> <span class="nl">sleep360</span><span class="p">:</span><span class="mi">1</span> <span class="o">--</span><span class="n">count</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>To listing the task use the following command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ecs</span> <span class="n">list</span><span class="o">-</span><span class="n">tasks</span> <span class="o">--</span><span class="n">cluster</span> <span class="n">MyCluster</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;taskArns&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s">&quot;arn:aws:ecs:ap-southeast-2:338764315603:task/7cceb4d5-8950-42a3-923e-b1859d401399&quot;</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>By passing the task ARN (listed above) to the following command we can see details of the running task.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err"></span> <span class="o">~/</span> <span class="n">aws</span> <span class="n">ecs</span> <span class="n">describe</span><span class="o">-</span><span class="n">tasks</span> <span class="o">--</span><span class="n">cluster</span> <span class="n">MyCluster</span> <span class="o">--</span><span class="n">task</span> <span class="mi">7</span><span class="n">cceb4d5</span><span class="o">-</span><span class="mi">8950</span><span class="o">-</span><span class="mi">42</span><span class="n">a3</span><span class="o">-</span><span class="mi">923</span><span class="n">e</span><span class="o">-</span><span class="n">b1859d401399</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;failures&quot;</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>    <span class="s">&quot;tasks&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="s">&quot;taskArn&quot;</span><span class="o">:</span> <span class="s">&quot;arn:aws:ecs:ap-southeast-2:338764315603:task/7cceb4d5-8950-42a3-923e-b1859d401399&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&quot;overrides&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="s">&quot;containerOverrides&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                    <span class="p">{</span>
</span><span class='line'>                        <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;sleep&quot;</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">]</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="s">&quot;lastStatus&quot;</span><span class="o">:</span> <span class="s">&quot;RUNNING&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&quot;containerInstanceArn&quot;</span><span class="o">:</span> <span class="s">&quot;arn:aws:ecs:ap-southeast-2:338764315603:container-instance/3de53ed6-5017-46fa-9b9f-37ad8a2b9da6&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&quot;clusterArn&quot;</span><span class="o">:</span> <span class="s">&quot;arn:aws:ecs:ap-southeast-2:338764315603:cluster/MyCluster&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&quot;desiredStatus&quot;</span><span class="o">:</span> <span class="s">&quot;RUNNING&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&quot;taskDefinitionArn&quot;</span><span class="o">:</span> <span class="s">&quot;arn:aws:ecs:ap-southeast-2:338764315603:task-definition/sleep360:1&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&quot;containers&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="s">&quot;containerArn&quot;</span><span class="o">:</span> <span class="s">&quot;arn:aws:ecs:ap-southeast-2:338764315603:container/d440587d-b23b-45f3-a2a8-ff8b195d0240&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="s">&quot;taskArn&quot;</span><span class="o">:</span> <span class="s">&quot;arn:aws:ecs:ap-southeast-2:338764315603:task/7cceb4d5-8950-42a3-923e-b1859d401399&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;sleep&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="s">&quot;networkBindings&quot;</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>                    <span class="s">&quot;lastStatus&quot;</span><span class="o">:</span> <span class="s">&quot;RUNNING&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="s">&quot;exitCode&quot;</span><span class="o">:</span> <span class="mi">0</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Step 8 (Final): SSH into the EC2 machine and list running container</h2>

<p>In the final step  we want to ssh into the machine and list the containers inside the machine.</p>

<p>ssh -i MyKeyPair.pem ec2-user@EC2-Public-IP-ADDRESS</p>

<p>after login into the machine, you can issue  <code>packer -ps</code>  command to list the containers. you should see the  <code>ecs-agent</code> and  <code>sleep 360</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">ec2</span><span class="o">-</span><span class="n">user</span><span class="p">@</span><span class="n">ip</span><span class="o">-</span><span class="n">xxx</span><span class="o">-</span><span class="n">xxx</span><span class="o">-</span><span class="n">xxx</span><span class="o">-</span><span class="n">xx</span> <span class="o">~</span><span class="p">]</span><span class="err">$</span> <span class="n">docker</span> <span class="n">ps</span>
</span><span class='line'><span class="n">CONTAINER</span> <span class="n">ID</span>        <span class="n">IMAGE</span>                            <span class="n">COMMAND</span>             <span class="n">CREATED</span>             <span class="n">STATUS</span>                  <span class="n">PORTS</span>                        <span class="n">NAMES</span>
</span><span class='line'><span class="mi">95</span><span class="n">d32fb0a1a2</span>        <span class="nl">busybox</span><span class="p">:</span><span class="n">latest</span>                   <span class="s">&quot;sleep 360&quot;</span>         <span class="mi">1</span> <span class="n">seconds</span> <span class="n">ago</span>       <span class="n">Up</span> <span class="n">Less</span> <span class="n">than</span> <span class="n">a</span> <span class="n">second</span>                                <span class="n">ecs</span><span class="o">-</span><span class="n">sleep360</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">sleep</span><span class="o">-</span><span class="n">fec1a8f1fbfd9d82d601</span>
</span><span class='line'><span class="mi">0</span><span class="n">ad94851d185</span>        <span class="n">amazon</span><span class="o">/</span><span class="n">amazon</span><span class="o">-</span><span class="n">ecs</span><span class="o">-</span><span class="nl">agent</span><span class="p">:</span><span class="n">latest</span>   <span class="s">&quot;/agent&quot;</span>            <span class="mi">11</span> <span class="n">minutes</span> <span class="n">ago</span>      <span class="n">Up</span> <span class="mi">11</span> <span class="n">minutes</span>           <span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">51678</span><span class="o">-&gt;</span><span class="mi">51678</span><span class="o">/</span><span class="n">tcp</span>   <span class="n">ecs</span><span class="o">-</span><span class="n">agent</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hope you enjoy this blog post and helps you to understand the ECS service more.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/27/amazon-s3-notes/">Amazon S3 Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-27T22:48:19+10:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:48 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some Notes about the Amazon Simple Storage Service (S3) service. You will find it useful if you want to prepare for AWS architecture certificate exam.</p>

<p>Amazon Simple Storage Service (S3) :</p>

<ul>
<li>Files can be from 1 Byte to 5 TB</li>
<li>Files are stored in Buckets and there is no limit.</li>
<li>Buckets name must be unique in a region level</li>
<li>Buckets are private by default</li>
<li>S3 Files are stored as a object in buckets</li>
<li>S3 supports MultiPart uploads,It is necessary for files bigger than 5Gb</li>
<li>S3 support resumable uploads.</li>
<li>S3 is consistent cross availability zones</li>
<li>S3 has a Life Cycle management, you can archive data after a specific time period from upload time in glacier.</li>
<li>Amazon S3 designed for 11 nines durability , 99.99999999999 in a given year</li>
<li>Amazon S3 availability is 99.99% in a given  year</li>
<li>Files can be encrypted on S3</li>
<li>S3 has versioning feature , includes all writes even if you delete an object</li>
<li>When you enable the versioning , you can not disable it , but you can suspend it</li>
<li>Reduced Redundancy Storage (RSS) data availability and durability is 99.99%</li>
<li>RSS is suitable for storing low frequency data.</li>
<li>RSS Cost: 3 Cent per GB per Month</li>
<li>Glacier is a low cost storage service suitable for data archiving.</li>
<li>Glacier Cost: 1 Cent per GB per Month</li>
<li>Glacier retrieval time 3 to 5 Hours</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/27/amazon-sns-notes/">Amazon SNS Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-27T22:10:57+10:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:10 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some Notes about the Amazon SMS service. You will find it useful if you want to prepare for AWS architecture certificate exam.</p>

<p>Amazon Simple Notification service  (SNS) :</p>

<ul>
<li>Is a web service that makes it easy to set up, operate, and send notifications from the cloud.</li>
<li>Amazon SNS allows the &ldquo;publish-subscribe&rdquo; (pub-sub) messaging paradigm.</li>
<li>SNS eliminates the need to periodically check or pull for new information and updates.</li>
<li>it is inexpensive, pay-as-you-go model with no up-front costs.</li>
<li>Amazon SNS can be deliver notifications by SMS text messages or email, to Amazon Simple Queue Service (SQS) queues, or any HTTP endpoint.</li>
<li>To prevent messages from being lost,all messages published to Amazon SNS are stored redundantly across multiple availability zones.</li>
<li>SNS Topic allows you to group multiple recipients. It acts like a access point for allowing recipients to dynamically subscribe for identical copies of the same notification.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/27/amazon-swf-notes/">Amazon SWF Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-27T22:10:17+10:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:10 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some Notes about the Amazon SWF service. You will find it useful if you want to prepare for AWS architecture certificate exam.</p>

<p>Amazon Simple Work flow Service (SWF):</p>

<ul>
<li>is a web service that makes it easy to coordinate work across distributed application components.</li>
<li>enables applications for a range of use cases, including media processing, web application back-ends, business process work flows, and analytics pipelines.</li>
<li>Tasks represent invocations of various processing steps in an application which can be performed by executable code, web service calls, human actions and scrips.</li>
<li>SWF presents a task-oriented API</li>
<li>SWF ensures that a task is assigned only once and is never duplicated.</li>
<li>SWF keeps track of all the tasks and events in an application.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/27/amazon-sqs/">Amazon SQS Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-27T22:09:04+10:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:09 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some Notes about the Amazon SQS service. You will find it useful if you want to prepare for AWS architecture certificate exam.</p>

<p>Amazon Simple queue service (SQS):</p>

<ul>
<li>is A web service that gives you access to a message queues.</li>
<li>Queues can be used to store messages while waiting for a computer to process them.</li>
<li>is distributed Queue System.</li>
<li>is fast and reliable</li>
<li>A queue is a temporary repository for messages hat are waiting processing.
*By using SQS you can decouple the components of an application so they run independently.</li>
<li>Messages can contain up to 256KB of text in any format.</li>
<li>Messages can be retrieved by any distributed component by using Amazon SQS API.</li>
<li>Amazon SQS ensures delivery of each message at least once. so one message can be read by many distributed application components simultaneously. And They are remained until you remove them from the queue yourself.</li>
<li>SQS does not support FIFO ( First In Firs Out).</li>
<li>SQS is a pull system , and messages are not pushed out like SNS.</li>
<li>Visibility time out period for a message starts when a component retrieves the message. The default visibility time out is minimum 30 seconds and maximum 12 hours.</li>
<li>SQS Billed at 64kb Chunks.</li>
<li>Firs 1 million Amazon SQS request per month are free.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/27/amazon-vpc/">Amazon VPC Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-27T22:08:11+10:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:08 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some Notes about the Amazon VPC service. You will find it useful if you want to prepare for AWS architecture certificate exam.</p>

<p>Amazon VPC:</p>

<ul>
<li>It is like a virtual data center in cloud.</li>
<li>lets you provision a logically isolated sections of the Amazon web service (AWS) cloud.</li>
<li>you have complete control over your virtual network environment.</li>
<li>you can select your own IP address range.</li>
<li>you can create your subnets.</li>
<li>you can configure route tables.</li>
<li>you can setup network gateways ( Internet gateway and Customer gateway).</li>
<li>With VPC you have two level of security:

<ul>
<li>  instance security groups.</li>
<li>  subnet network access control lists (ACLS)</li>
</ul>
</li>
<li>Using Amazon Direct Connect you can connect your corporate data center and your AWS VPC.</li>
<li>There is a default VPC which is user friendly, allowing you to immediately deploy instances.</li>
<li>All Subnets in default VPC have an Internet gateway attached.</li>
<li>Each EC2 instance has both a public and private IP addresses.</li>
<li>If you delete the default VPC the only way to get it back is to contact AWS.</li>
<li>you can user VPC Peering to connect one VPC with another.</li>
<li>when you use VPC Peering , instances behave as if they were on the same private network.</li>
<li>you can peer even VPC&rsquo;s with other AWS accounts.</li>
<li>Peering is in a star configuration.So Siblings VPC&rsquo;s can not directly talk to each other and should use centric one.</li>
<li>Elastic IP addresses, Internet Gateways, VPCs per region : Max 5</li>
<li>VPC connections per region, Customer Gateways per region: Max 50</li>
<li>Route tables per region: Max 200</li>
<li>Security groups per VPC: Max 100</li>
<li>Rules per security group: Max 50</li>
<li>Dedicated VPC&rsquo;s are expensive because all of instance underneath will be dedicated.</li>
<li>When you create a VPC, one route table and one ACL will be created automatically.</li>
<li>Your subnets can not be in different availability zones , just in one AZ.</li>
<li>you can have only One Internet gateway per VPC.</li>
<li>putting an instance in a public subnet is not enough to make public access to that instance.you should assign public IP address to it to make it accessible from the Internet.</li>
<li>For making a NAT instance as a router for routing private subnet traffic to the Internet you should disable source/destination check for that NAT instance.</li>
<li>Access Control list act as firewall and rules are applied to the entire subnet.
*If you don&rsquo;t associate a ACL to a subnet, default ACL which allows all incoming and outgoing traffic will be assigned to a subnet automatically.</li>
<li>Rules in ACL assigned order numbers, so rule #100 evaluated before rule #200. Amazon recommends to increment rules number by 100.</li>
<li>When you create a new ACL, incoming and outgoing traffic is denied by default.</li>
<li>Like as a firewall , Only one ACL can be assigned to the subnet.cardinality between ACL-Subnet is Many to one.</li>
<li>Amazon corporate network is segregated from AWS network.</li>
<li>Port scanning is not allowed in AWS by default. for vulnerability scan you must request it from amazon for a short period.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/27/amazon-redshift-notes/">Amazon RedShift Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-27T22:06:33+10:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:06 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some Notes about the Amazon RedShift service. You will find it useful if you want to prepare for AWS architecture certificate exam.</p>

<p>Amazon RedShift is the Amazon warehouse service in cloud, characteristics are :</p>

<ul>
<li>fast and powerful</li>
<li>fully managed service</li>
<li>Peta byte scale</li>
<li>Instead of storing data as a series of rows, it has columnar data storage</li>
<li>Column-based storage require far fewer I/Os so greatly improving query performance</li>
<li>10 Time Faster than traditional data warehouses.</li>
<li>in column-base storage , similar data is stored sequentially , so data can be compressed much more than row-base storage,</li>
<li>RedShift automatically samples your data and select the most appropriate compression schema.</li>
<li>Redshift has MPP ( Massively Parallel Processing) feature.</li>
<li>by MPP , data are distributed and queries load across all nodes to your data</li>
<li>cost is less than a tenth of most other data warehouse solutions.</li>
<li>configuration of RedShif can be Single node(160Gb) or Multi-node.</li>
<li>in Multi-Node mode , One node is Leader node , and then you can create  up to 128 compute nodes.</li>
<li>Leader node manages client connections and receives queries</li>
<li>Computed Node store data and perform queries and do computations</li>
<li>You will not charged for leader node hours; only compute nodes will incur charges.</li>
<li>Encrypted in transit using SSL.</li>
<li>Encrypted at rest using AES-256</li>
<li>By default Redshift takes care of key management</li>
<li>You can manage your own keys through HSM or by Amazon Key Management Service.</li>
<li>Currently only available in 1 AZ</li>
<li>Can restore snapshots to new AZ&rsquo;s in the event of outage.</li>
<li>Fail over is not automatically , it&rsquo;s manual.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/27/amazon-dynamodb-notes/">Amazon DynamoDB Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-27T22:05:47+10:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:05 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some Notes about the Amazon DynamoDB service. You will find it useful if you want to prepare for AWS architecture certificate exam.</p>

<ul>
<li>Amazon DynamoDb is a fast and flexible NoSQL database service.</li>
<li>single digit millisecond latency at any scale</li>
<li>fully managed</li>
<li>supports both document and key-value data</li>
<li>It&rsquo;s flexible data model and reliable performance make it a great fit for mobile, web, gaming, ad-tech, IoT, and many other applications.</li>
<li>Stored on SSD storage</li>
<li>spread across 3 geographically distinct data centres</li>
<li>It supports both of Eventual Consistency and Strong Consistency.</li>
<li>Integrated with RedShift and Elastic Map Reduce (EMR)</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/27/amazon-rds-notes/">Amazon RDS Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-27T22:04:28+10:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:04 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p> Some Notes about the Amazon RDS service. You will find it useful if you want to prepare for AWS architecture certificate exam.</p>

<ul>
<li>Amazon RDS now supports these Relational (OLTP): MySQL, Oracle , SQL , PostgreSql, Aurora</li>
<li>Supports Non-Relational No-SQL database , DynamoDB</li>
<li>Supports Data warehousing database (OLAP), RedShift</li>
<li>Supports ElasticCache (fast in-memory cache service), MemCached and Redis</li>
<li>Aurora is a MySql Compatible Database , Not accessible yet.</li>
<li>Aurora provides up to five times better performance than MySQL.</li>
<li>Aurora cost is one tenth that of a commercial database while delivering similar performance and availability.</li>
<li>Aurora start with 10Gb, Scales in 10 Gb increments to 64Tb.</li>
<li>compute resources can scale up to 32vCPUs and 244 Gb of Memory.</li>
<li>Aurora storage is self-healing. Data blocks scanned and fixed automatically.</li>
<li>you can loose 2 copies without effecting write performance.</li>
<li>you can loose 3 copies without effecting read performance.</li>
<li>Maximum Backup Retention Period for RDS is 35 days</li>
<li>When you want restore database to specific time , entirely new database will be created and endpoints will be different from the original database endpoint</li>
<li>you can bring your own license in the case of selecting Oracle and SQL Server as a RDS Engine.</li>
<li>You can modify MySql DB instance and increase storage size , change engine , change database name , password and &hellip;</li>
<li>Microsoft SQL server DB instance has some restrictions:</li>
<li> You can not modify Microsoft SQL server DB instance storage size , Amazon does not support increasing storage on a SQL server DB Instance.</li>
<li> A newly created SQL server does not contain database. you should connect from SQL server management studio and create your database.</li>
<li>The maximum storage size for SQL server DB instance is 1024 GB.</li>
<li>Read replicas are available in Amazon RDS for MySQL, PostgreSQL, and Amazon Aurora.</li>
<li>Amazon RDS for MySQL and PostgreSQL allow you to add up to 5 read replicas to each DB Instance.</li>
<li>With Aurora you will get 6 copies of your data (2 copies in each 3 AZ).</li>
<li>Replication is only supported for the InnoDB storage engine.</li>
<li>When you provision a Multi-AZ DB Instance, Amazon RDS automatically creates a primary DB Instance and synchronously replicates the data to a standby instance in a different Availability Zone (AZ)</li>
<li>you can monitor you Read Replica using CloudWatch Replica Lag statistic. If a replica lags too far behind for your environment, consider deleting and recreating the Read Replica</li>
<li>If you scale the source DB instance, you should also scale the Read Replicas.
<em>you can create ReadReplica1 from MyDBInstance, and then create ReadReplica2 from ReadReplica1.
</em>Before a DB instance can serve as a source DB instance, you must enable automatic backups on the source DB instance by setting the backup retention period to a value other than 0.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/25/ec2-essentials/">EC2 Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-25T12:27:57+10:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:27 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some Notes about the Elastic compute cloud , you will find it useful if you want to prepare for AWS architecture certificate exam.</p>

<ul>
<li>Elastic Compute Cloud provides re-sizable compute capacity in cloud.</li>
<li>It can be scale up or down as computing requirements changed.</li>
<li>EC2 Options: Free Tier, On Demand , Reserved and Spot.</li>
<li>Data Stored on a local instance storage will be deleted when you stop the instance.</li>
<li>EBS backed storage will persist independently of the life of the instance</li>
<li>AWS uses standard technologies detailed in DoD 5220.22-M or NIST 800-88 guidelines for media sanitization to destroy data as part of the decommissioning process.</li>
<li>EBS volume can be attached to only One instance at a time.</li>
<li>Types of storage backed by EBS:

<ul>
<li>  General purpose SSD , 99.999% availability,</li>
<li>  Provisioned IOPS SSD, Designed for IO intensive applications</li>
<li>  Magnetic, Low cost , Suitable for infrequent accessed data</li>
</ul>
</li>
<li>Identity Access Management (IAM) roles can not be assigned to an EC2 instance after the instance has been created.</li>
<li>You can not add or change roles to an existing EC2 instance but you can change the permissions of a assigned role.</li>
<li>EC2 placement group properties:

<ul>
<li>  group of logical groups of instances in only one singe AZ</li>
<li>  Are low latency ; has 10GBbps network throughput.</li>
<li>  The name you choose for placement group should be unique in AWS account</li>
<li>  Same size instances recommended to be put in a group</li>
<li>  placement groups cannot be merged.</li>
<li>  you can add existing instances to your placement group by creating AMI form that instance and then launch it to your placement group</li>
</ul>
</li>
<li>Lambda is a compute service which run a code in response of events occurs in your resources and automatically manage that resource for you.</li>
<li>Responses of lambda including capacity provisioning, OS and servers maintenance, security patch , logging and &hellip;</li>
<li>Supported programming language for lambda is JavaScript.</li>
<li>Lambda designed to be available in 99.99%</li>
<li>First one million request of Lambda are free and there after is 0.20 per 1 mil request</li>
<li>Copying snapshots that were encrypted with non-default AWS Key Management Service master keys is not supported at this time.</li>
<li>Snapshots are sent/stored on Amazon S3</li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/14/setup-a-aws-ecs-container-purely-using-cli/">Setup a AWS ECS Container Purely Using CLI</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/27/amazon-s3-notes/">Amazon S3 Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/27/amazon-sns-notes/">Amazon SNS Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/27/amazon-swf-notes/">Amazon SWF Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/27/amazon-sqs/">Amazon SQS Notes</a>
      </li>
    
  </ul>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/reza.farshi?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Reza Farshi -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'farshidesigns';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<a title="Real Time Web Analytics" href="http://clicky.com/100835142"><img alt="Real Time Web Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100835142); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100835142ns.gif" /></p></noscript>


</body>
</html>
